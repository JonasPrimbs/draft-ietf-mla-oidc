openapi: 3.0.3
info:
  title: OIDC RIDT Userinfo Endpoint
  description: Endpoint for OpenID Connect's Remote ID Token endpoint for userinfo.
  version: 0.1.0
servers:
  - url: 'http://localhost:8080/sso/realms/demo/protocol/openid-connect/userinfo'
paths:
  /ridt:
    post:
      summary: Request a new RIDT
      description: Request a new Remote ID Token
      operationId: genRidt
      requestBody:
        description: Authenticate and send request parameters for a new Remote ID Token.
        content:
          application/jwt:
            schema:
              $ref: '#/components/schemas/RemoteIdTokenRequestJwt'
        required: true
      responses:
        '201':
          description: |
            **Created**
            
            Returns the generated Remote ID Token with additional information about it.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IatResponse'
        '401':
          description: |
            **Unauthorized**
            
            Possible reasons:
              - Access Token not provided.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorStatus'
              examples:
                AccessTokenMissing:
                  summary: Access Token not found
                  value: {
                    "code": 401,
                    "status": "Unauthorized",
                    "description": "Access Token not found"
                  }
        '403':
          description: |
            **Forbidden**
            
            Possible reasons:
              - Access Token not valid
              - Proof of Possession not valid
              - Proof of Possession not provided
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorStatus'
              examples:
                AccessTokenInvalid:
                  summary: Access Token not valid
                  value: {
                    "code": 403,
                    "status": "Forbidden",
                    "description": "Access Token not valid"
                  }
                PopInvalid:
                  summary: Proof of Possession not valid
                  value: {
                    "code": 403,
                    "status": "Forbidden",
                    "description": "Proof of Possession not valid"
                  }
                PopMissing:
                  summary: Access Token not valid
                  value: {
                    "code": 403,
                    "status": "Forbidden",
                    "description": "Proof of Possession not found"
                  }
        '500':
          description: |
            **Internal Server Error**
            
            Possible reasons:
            - Connection to OpenID Provider failed.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorStatus'
              examples:
                Unknown:
                  summary: Unknown Server Error
                  value: {
                    "code": 500,
                    "status": "Internal Server Error",
                    "description": "Invalid Server Error"
                  }
      security:
        - iat_auth:
            - openid
            - profile
            - email
components:
  schemas:
    ErrorStatus:
      type: object
      description: Information about ocurred error.
      properties:
        code:
          type: number
          format: uint
          description: Status Code
        status:
          type: string
          description: Status Text
        description:
          type: string
          description: More detailled description
      required:
        - code
        - status
    RemoteIdTokenRequestJwt:
      type: string
      format: jwt
      description: |
        A JSON Web Token (JWT) which MUST
          - contain the client's public key in the JWT header (`"jwk": <public-key>`)
          - be issued by the client (`"iss": "<client-id>"`)
          - have the OpenID Provider as audience (`"aud": "<op-id>"`)
          - have the requested user's ID as subject (`"sub": "<user-id>"`)
          - have an issued at date (`"iat": <issuance-time>`)
          - have an expiration date (`"exp": <expiration-time>`)
          - be valid for at most 10 minutes (`"exp"` minus `"nbf"` or `"iat"` is less or equal `600`)
          - contain a unique nonce (`"nonce": "<random string>"`), OR a unique JWT ID (`"jti": "<jwt-id>"`), OR both
          - contain the requested claims as a comma-separated string (`"claims": "<claim-0> <claim-1>"`)
          - be signed with the client's private key
      example: eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCIsImp3ayI6eyJrdHkiOiJFQyIsImNydiI6IlAtMjU2IiwieCI6ImNYUThiZGVOZWVTd2ZMa0h6TWZBVUZySGxMWFpXdkpybW9NMnNDUEdVbmciLCJ5IjoiN0Rwd21Pb0hJbmQwUWNSRVJUS1pBQ2k5YndzYTVnR0tER3hGeG00OEdSQSJ9fQ.eyJpc3MiOiJjbGllbnQuc2FtcGxlLm9yZyIsInN1YiI6InVzZXJAc2FtcGxlLm9yZyIsImF1ZCI6Imh0dHBzOi8vYWNjb3VudHMuc2FtcGxlLm9yZy8iLCJpYXQiOjE2NTkzNTUyMDAsIm5iZiI6MTY1OTM1NTIwMCwiZXhwIjoxNjU5MzU1MjYwLCJub25jZSI6IlZqZlU0Nlo1eWtJaG43akp6cVpvV0srcGFxNjNFS3VIIiwiY2xhaW1zIjoibmFtZSBlbWFpbCBlbWFpbF92ZXJpZmllZCJ9.6iGZaJrC5dcbYWZbgZKSNq9k0GZvL0jeXrD-8iv_wt1ZYgEuI6SLoZWc5TGayheDS7Kr1uwKTIa6Nm8RCv0TYQ
    IatResponse:
      type: object
      properties:
        remote_id_token:
          $ref: '#/components/schemas/RemoteIdToken'
        expires_in:
          type: number
          format: uint
          description: Number of seconds until the Remote ID Token expires.
          example: 3600
        claims:
          type: array
          description: Array of claims provided in the Remote ID Token.
          items:
            type: string
          example: ["name", "email", "email_verified"]
      required:
        - id_assertion_token
        - expires_in
        - claims
    RemoteIdToken:
      type: string
      format: jwt+dpop
      description: |
        **Remote ID Token** as `jwt+dpop` which MUST
          - contain a JWK Key ID of the OpenID Provider's key pair which is used for signing this token (`"kid": <key-id>`) in the JWT header
          - be issued by the OpenID Provider (`"iss": "<op-id>"`)
          - have the requested user's ID as subject (`"sub": "<user-id>"`)
          - have an issued at date (`"iat": <issuance-time>`)
          - have an expiration date (`"exp": <expiration-time>`)
          - be valid for at most 24 hours (`"exp"` minus `"nbf"` or `"iss"` is less or equal `86400`)
          - contain a unique nonce (`"nonce": "<random string>"`), OR a unique JWT ID (`"jti": "<jwt-id>"`), OR both
          - contain the client's public key as confirmation claim (`"cnf": { "jwk": <public-key> }`)
          - contain the requested claims (e.g., `"name": "<full-name>"`, `"email": "<email-address>"`, ...), but only if they are covered by the scopes of the provided Access Token
          - be signed with the OpenID Provider's private key
      example: eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCtEUE9QIiwia2lkIjoxfQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLnNhbXBsZS5vcmcvIiwic3ViIjoidXNlckBzYW1wbGUub3JnIiwiaWF0IjoxNjU5MzU1MjA1LCJuYmYiOjE2NTkzNTUyMDUsImV4cCI6MTY1OTM1ODgwNSwibm9uY2UiOiIvVDE3NnF0RXcvdTM1UU9yWFRHVjFubFVEVTVFYUV6VyIsImNuZiI6eyJqd2siOnsia3R5IjoiRUMiLCJjcnYiOiJQLTI1NiIsIngiOiJjWFE4YmRlTmVlU3dmTGtIek1mQVVGckhsTFhaV3ZKcm1vTTJzQ1BHVW5nIiwieSI6IjdEcHdtT29ISW5kMFFjUkVSVEtaQUNpOWJ3c2E1Z0dLREd4RnhtNDhHUkEifX0sIm5hbWUiOiJKb2huIFNtaXRoIiwiZW1haWwiOiJqb2huLnNtaXRoQG1haWwuc2FtcGxlLm9yZyIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlfQ.Y_ag4noTNgauNoFrhUP8dPbZAK2dC4iaFtEuM2yX_Me-Rlvy-oCR7CQvkZc7-Ejq4l617Ke-6ywV408OvRV-MQ
  securitySchemes:
    iat_auth:
      type: oauth2
      flows:
        implicit:
          authorizationUrl: 'http://localhost:8080/sso/realms/demo'
          scopes:
            openid: |
              **General OpenID Connect authorization**
            profile: |
              **OpenID Connect profile information**
              
              Authorizes access to the following profile claims:
                - `name`
                - `family_name`
                - `given_name`
                - `middle_name`
                - `nickname`
                - `preferred_username`
                - `profile`
                - `picture`
                - `website`
                - `gender`
                - `birthdate`
                - `zoneinfo`
                - `locale`
                - `updated_at`
            email: |
              **OpenID Connect email address information**
              
              Authorizes access to the following profile claims:
                - `email`
                - `email_verified`